
<%- include('../required/header.ejs') %>
<main>
            <main id="block15">
                <div class="col-lg-12 col-md-12 col-sm-12 pr-2" style="margin-left:-.8rem; margin-bottom:2.2rem;">
                    <div class="bx-shadow pt-2 pb-3">
                        <h5 class="heading-search font-weight-bold text-left pb-0" style="opacity:90%;">
                            Request for Hostel Change</h5>
                    </div>
                </div>
                <div class="row">

                    <% if(requests.length > 0) { %>
                <div class="col-lg-6 col-md-12 col-sm-12">
                    <div class="gri">
                        <% for(var i = 0; i < requests.length; i++) { %>
                            <% if(requests[i].clicked === false) { %>
                        <div class="bx-shadow1 pb-1">
                            <br>
                            <div class="col-lg-12 col-md-12 col-sm-12 search-bx bx-1 " id="myDiv">
                                <div class="row-view pt-3">
                                    <i class="material-icons icon position-absolute  pt-0 ml-2 "><%= requests[i].student_gender === "F" ? "female" : "male" %></i>
                                    <h6 class="fs-1 fst-bold pt-1 pl-5 "> <b class="mt-3"><%= requests[i].student_name %></b></h6>
                                    <p class="fw-300 ml-5 mb-0 custom-line-height nameee"
                                        style="color:#4f4f4f; opacity:90%;">
                                        <span class="ml-0"><%= requests[i].student_course %></span>
                                    </p>
                                    <p class="fw-300 ml-5 mt-1 mb-2 custom-line-height nameee"
                                        style="color:#4f4f4f; opacity:90%;">
                                        <span class="ml-0"><%= requests[i].student_year %></span><span class="ml-1">IV</span>
                                    </p>
                                </div>

                            </div>

                            <div class="search-bx col-lg-12 col-md-12 col-sm-12 search-det" id="myDiv">
                                <div class="bx-21" style="opacity:90%;">
                                    <p class="ml-3 mt-1 mb-0 font-weight-bold">From</p>

                                    <p class="fw-300 ml-3  mb-0 custom-line-height" style="color:#4f4f4f;">
                                        <span class="ml-0">Block :</span>
                                        <% for(var j = 0; j < blocks.length; j++) { %>
                                            <% if(requests[i].block == blocks[j]._id) { %>
                                       <b class="ml-4" style="color:#ff4b13"><%= blocks[j].block_name %></b>
                                        <% } %>
                                    <% } %>
                                    </p>
                                    <p class="fw-300 ml-3 mb-5 mb-0 custom-line-height" style="color:#4f4f4f; ">
                                        <span class="ml-0">Room :</span>
                                        <% for(var k = 0; k < rooms.length; k++) { %>
                                            <% if(requests[i].room == rooms[k]._id) { %>
                                        <b class="ml-4" style="color:#ff4b13"><%= rooms[k].room_name %></b>
                                        <% } %>
                                        <% } %>

                                    </p>


                                </div>
                                <div class="bx-22" style="opacity:90%;">
                                    <p class="ml-3 mt-2 mb-0 font-weight-bold">To</p>
                                    <p class="fw-300 ml-3  mb-0 custom-line-height" style="color:#4f4f4f;;">
                                        <span class="ml-0">Block :</span>
                                        <% for(var j = 0; j < blocks.length; j++) { %>
                                            <% if(requests[i].targetblock == blocks[j]._id) { %>
                                        <b class="ml-4" style="color:#ff4b13"><%= blocks[j].block_name %></b>
                                        <% } %>
                                        <% } %>
                                    </p>
                                    <p class="fw-300 ml-3 mb-0 custom-line-height" style="color:#4f4f4f; ">
                                        <span class=" ml-0">Room :</span>
                                        <% for(var j = 0; j < rooms.length; j++) { %>
                                            <% if(rooms[j]._id == requests[i].targetroom) { %>
                                        <b class="ml-4" style="color:#ff4b13"><%= rooms[j].room_name %></b>
                                        <% } %>
                                        <% } %>
                                    </p>
                                </div>
                            </div>

                            <div class="search-bx col-lg-12 col-md-12 deta col-sm-12" id="myDiv">
                                <div class="rea pl-2 pr-3 ">
                                    <div class="mt-3">
                                        <p class="fw-300 ml-3 mb-0 custom-line-height" style="color:#ff4b13;">
                                            <b class="ml-0">Reason </b>
                                        </p>
                                        <p class="fw-300 ml-3 custom-line-height par" style="color:#4f4f4f; ">
                                            <span class=" ml-0"><%= requests[i].reason %></span>
                                        </p>

                                    </div>
                                    <div class="view-proof pb-3">
                                        <!-- <i class='bx bx-image' style="font-size:24px;"></i> -->
                                        <p>Attached File : </p>
                                        <a href="/uploads/<%= requests[i].image %>" style="cursor: pointer;"><i class='bx bxs-file-blank' style="font-size: 24px; color: #ff4b13;"></i>
                                        </a>
                                    </div>

                                </div>
                            </div>
                            <div class="search-bx col-lg-12 col-md-12 deta col-sm-12  pb-4" id="myDiv">
                                <div class="mt-4 acdc" style="margin:0 auto;">
                                    <button data-id="<%= requests[i]._id %>" class="pr-4 pl-4 pt-1 pb-1 del accept-btn">Reject</button>
                                    <button data-id="<%= requests[i]._id %>" class="pr-4 pl-4 pt-1 pb-1 acc reject-btn">Accept</button>
                                </div>
                            </div>

                        </div>
                        <% } %>
                        <% } %>

                    </div>
                    </div>

                    <% }  else { %>

                        <h5 class="justify-content-center text-center pt-5 font-weight-bold">No request</h5>

                    <% } %>
                </div>
            </main>
        </main>
        <br><br><br><br><br><br><br><br>
    </section>

</body>

</main>









<!-- MAIN -->
</section>
<!-- NAVBAR -->

<script>
    function setFocus(on) {
        var element = document.activeElement;
        if (on) {
            setTimeout(function () {
            element.parentNode.classList.add("focus");
            });
        } else {
            let box = document.querySelector(".input-box");
            box.classList.remove("focus");
            $("input").each(function () {
            var $input = $(this);
            var $parent = $input.closest(".input-box");
            if ($input.val()) $parent.addClass("focus");
            else $parent.removeClass("focus");
            });
        }
        }
</script>

<script>
    $(document).ready(function() {
$(".accept-btn").click(function() {
    var id = $(this).attr("data-id");
    console.log(id);
// Show confirmation message using SweetAlert2
Swal.fire({
html: `<h5>Accept</h5>
	<form>
	    <div class="form-group">
		    <div class="input-box">
		        <label class="input-label">Remarks</label>
		        <textarea type="text" class="input-1"  style="height: 150px;" onfocus="setFocus(true)" id="remarks" onblur="setFocus(false)"></textarea>
		    </div>
		</div>
	</form>
        `,
        showCancelButton: true,
        showConfirmButton: true,
        confirmButtonColor: "#ff4b13",
        cancelButtonColor: "#000",
        confirmButtonText: "Okay",
        preConfirm: () => {
            const remarks = document.getElementById('remarks').value;
            // Return the values as an object
            return { remarks };
        }
}).then((result) => {
console.log("confirm result")
if (result.isConfirmed) {
    // Send AJAX request to delete block
                const { remarks } = result.value;
                const status = "accepted"
                fetch(request/update/${id}, {
                method: 'PUT',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({ remarks, status })
                })
                .then(response => {
                if (!response.ok) {
                console.log("response", response)
                throw new Error(response);
                }
                Toastify({
                text: 'Successfully Granted the request!',
                backgroundColor: 'linear-gradient(to right, #96c93d, #00b09b)',
                className: 'success',
                position: 'top-center',
                }).showToast();
                window.location.reload();
                })
                .catch(error => {
                console.error(error);
                Toastify({
                text: 'Error : ' + error.message,
                backgroundColor: 'linear-gradient(to right, #ff5f6d, #ffc371)',
                className: 'error',
                position: 'top-center',
                }).showToast();
                });

                                console.log("after ajax")

                }
                });
                });
                });
</script>

<script>
    $(document).ready(function() {
$(".reject-btn").click(function() {
    var id = $(this).attr("data-id");
    console.log(id);
// Show confirmation message using SweetAlert2
Swal.fire({
html: `<h5>Reject</h5>
	<form>
	    <div class="form-group">
		    <div class="input-box">
		        <label class="input-label">Remarks</label>
		        <textarea type="text" class="input-1"  style="height: 150px;" onfocus="setFocus(true)" id="remarks" onblur="setFocus(false)"></textarea>
		    </div>
		</div>
	</form>
        `,
        showCancelButton: true,
        showConfirmButton: true,
        confirmButtonColor: "#ff4b13",
        cancelButtonColor: "#000",
        confirmButtonText: "Okay",
        preConfirm: () => {
            const remarks = document.getElementById('remarks').value;
            // Return the values as an object
            return { remarks };
        }
}).then((result) => {
console.log("confirm result")
if (result.isConfirmed) {
    // Send AJAX request to delete block
                const { remarks } = result.value;
                const status = "rejected"
                fetch(request/update/${id}, {
                method: 'PUT',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify({ remarks, status })
                })
                .then(response => {
                if (!response.ok) {
                console.log("response", response)
                throw new Error(response);
                }
                Toastify({
                text: 'You have Rejected the request!',
                backgroundColor: 'linear-gradient(to right, #96c93d, #00b09b)',
                className: 'success',
                position: 'top-center',
                }).showToast();
                window.location.reload();
                })
                .catch(error => {
                console.error(error);
                Toastify({
                text: 'Error : ' + error.message,
                backgroundColor: 'linear-gradient(to right, #ff5f6d, #ffc371)',
                className: 'error',
                position: 'top-center',
                }).showToast();
                });



                }
                });
                });
                });
</script>



</body>

</html>
